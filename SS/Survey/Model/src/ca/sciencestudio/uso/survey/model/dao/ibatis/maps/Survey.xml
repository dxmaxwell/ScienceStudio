<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Survey" >
	<resultMap  class="ca.sciencestudio.uso.survey.model.Survey" id="survey">
		<result property="id"                         column="survey_id"/>
		<result property="name"                       column="survey_name"/>
		<result property="categoryId"                 column="category_id"/>
		<result property="description"                column="description"/>
		<result property="participantDescription"     column="participant_description"/>
		<result property="status"                     column="status"/>
		<result property="deadline"                   column="deadline"/>
		<result property="createTime"                 column="create_time"/>
	</resultMap>

	<select id="getSurveyById" resultMap="survey">
		SELECT * 
			FROM ${database}.survey
			WHERE survey_id = #value#
	</select>
	
	<insert id="addSurvey">
		INSERT INTO ${database}.survey 
			(survey_name, description, category_id, participant_description, status, deadline, create_time)
		VALUES 
			(#name:VARCHAR#, #description:VARCHAR#, #categoryId:INTEGER#, #participantDescription:VARCHAR#, #status:INTEGER#, #deadline:DATE#, CURRENT_TIMESTAMP)		
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			 ${identity.function}
		</selectKey>
	</insert>

	<delete id="removeSurvey">
		DELETE 
			FROM ${database}.survey
			WHERE survey_id = #value#
	</delete>
	
	<update id="updateSurvey">
		UPDATE ${database}.survey
			SET 
				survey_name = #name:VARCHAR#,
				category_id = #categoryId:INTEGER#,
				description = #description:VARCHAR#,
				participant_description = #participantDescription:VARCHAR#,
				status = #status:INTEGER#,
				deadline = #deadline:DATE#
			WHERE 
				survey_id = #id:INTEGER#
	</update>
	
	<select id="getSurveyListByCategory" resultMap="survey">
		SELECT * 
			FROM ${database}.survey
			WHERE category_id = #value#
	</select>
</sqlMap>