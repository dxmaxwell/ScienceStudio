<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Survey" >
	<resultMap  class="ca.sciencestudio.uso.survey.model.SurveySection" id="section">
		<result property="id"                         column="section_id"/>
		<result property="name"                       column="section_name"/>
		<result property="surveyId"                   column="survey_id"/>
		<result property="order"                      column="section_order"/>
		<result property="description"                column="description"/>
	</resultMap>

	<select id="getSurveySectionById" resultMap="section">
		SELECT * 
			FROM ${database}.survey_section
			WHERE section_id = #value#
	</select>
	
	<insert id="addSurveySection">
		INSERT INTO ${database}.survey_section
			(section_name, survey_id, section_order, description)
		VALUES 
			(
				#name:VARCHAR#,
				#surveyId:INTEGER#,
				#order:INTEGER#,
				#description:VARCHAR#)		
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			 ${identity.function}
		</selectKey>
	</insert>
	
	<delete id="removeSurveySection">
		DELETE 
			FROM ${database}.survey_section
			WHERE section_id = #value#
	</delete>
	
	<update id="updateSurveySection">
		UPDATE ${database}.survey_section
			SET 
				section_name = #name:VARCHAR#,
				survey_id = #surveyId:INTEGER#,
				section_order = #order:INTEGER#,
				description = #description:VARCHAR#
			WHERE 
				section_id = #id:INTEGER#
	</update>
	
	<select id="getSurveySectionList" resultMap="section">
		SELECT * 
			FROM ${database}.survey_section
			WHERE survey_id = #value#
			ORDER BY section_order
	</select>
	
	<select id="getSurveyMaxSectionOrder" resultClass="java.lang.Integer">
		SELECT Max(section_order)
			FROM ${database}.survey_section
			WHERE survey_id = #value#
	</select>
</sqlMap>