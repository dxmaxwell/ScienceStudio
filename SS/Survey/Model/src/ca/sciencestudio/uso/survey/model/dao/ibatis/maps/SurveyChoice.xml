<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Survey" >
	<resultMap  class="ca.sciencestudio.uso.survey.model.SurveyChoice" id="choice">
		<result property="id"                         column="choice_id"/>
		<result property="questionId"                 column="question_id"/>
		<result property="order"                      column="choice_order"/>
		<result property="text"                       column="choice_text"/>
		<result property="image"                      column="image"/>
	</resultMap>

	<select id="getSurveyChoiceById" resultMap="choice">
		SELECT * 
			FROM ${database}.survey_choice
			WHERE choice_id = #value#
	</select>
	
	<insert id="addSurveyChoice">
		INSERT INTO ${database}.survey_choice
			(question_id, choice_order, choice_text, image)
		VALUES 
			(
				#questionId:INTEGER#,
				#order:INTEGER#,
				#text:VARCHAR#,
				#image:VARCHAR#)		
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			 ${identity.function}
		</selectKey>
	</insert>
	
	<delete id="removeSurveyChoice">
		DELETE 
			FROM ${database}.survey_choice
			WHERE choice_id = #value#
	</delete>
	
	<update id="updateSurveyChoice">
		UPDATE ${database}.survey_choice
			SET 
				question_id = #questionId:INTEGER#,
				choice_order = #order:INTEGER#,
				choice_text = #text:VARCHAR#,
				image = #image:VARCHAR#
			WHERE 
				choice_id = #id:INTEGER#
	</update>
	
	<select id="getSurveyChoiceList" resultMap="choice">
		SELECT * 
			FROM ${database}.survey_choice
			WHERE question_id = #value#
			ORDER BY choice_order
	</select>
	
	<select id="getSurveyMaxChoiceOrder" resultClass="java.lang.Integer">
		SELECT Max(choice_order)
			FROM ${database}.survey_choice
			WHERE question_id = #value#
	</select>
</sqlMap>