<?xml version="1.0" encoding="UTF-8"?>
<!--
	Copyright (c) Canadian Light Source, Inc. All rights reserved.
	see license.txt for details.
	
	Description:
		Project sql map xml file.	
 -->
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Project">
	<resultMap id="project" class="ca.sciencestudio.model.project.ibatis.IbatisProject">
		<result property="id" column="project_id" />
		<result property="name" column="name"/>
		<result property="description" column="description"/>
		<result property="startDate" column="start_date" />
		<result property="endDate" column="end_date" />
		<result property="statusString" column="status"/>
	</resultMap>
	
	<insert id="addProject">
		INSERT INTO scstudio.project
		(
			name,
			description,
			start_date,
			end_date,
			status
		) 
		VALUES
		(
			#name:VARCHAR#,
			#description:VARCHAR#,
			#startDate:DATE#,
			#endDate:DATE#,
			#statusString:VARCHAR#
		)
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			${identity.function}
		</selectKey>
	</insert>
	
	<update id="editProject">
		UPDATE scstudio.project
			SET
				name = #name:VARCHAR#,
				description = #description:VARCHAR#,
				start_date = #startDate:DATE#,
				end_date = #endDate:DATE#,
				status = #statusString:VARCHAR#
			WHERE
				project_id = #id:INT#
	</update>
	
	<delete id="removeProject">
		DELETE FROM scstudio.project
			WHERE project_id = #value#
	</delete>
	
	<select id="getProjectById" resultMap="project">
		SELECT * FROM scstudio.project 
			WHERE project_id = #value#
	</select>
	
	<select id="getProjectByScanId" resultMap="project">
		SELECT p.project_id, p.name, p.description, p.start_date, p.end_date, p.status
			FROM scstudio.project AS p, scstudio.session AS s, scstudio.experiment AS e, scstudio.scan AS scan
			WHERE scan.scan_id = #value# AND scan.experiment_id = e.experiment_id
				AND e.session_id = s.session_id AND s.project_id = p.project_id
	</select>
	
	<select id="getProjectBySessionId" resultMap="project">
		SELECT p.project_id, p.name, p.description, p.start_date, p.end_date, p.status
			FROM scstudio.project AS p, scstudio.session AS s
			WHERE s.session_id = #value# AND s.project_id = p.project_id
	</select>
	
	<select id="getProjectByExperimentId" resultMap="project">
		SELECT p.project_id, p.name, p.description, p.start_date, p.end_date, p.status
			FROM scstudio.project AS p, scstudio.session AS s, scstudio.experiment AS e
			WHERE e.experiment_id = #value# AND e.session_id = s.session_id AND s.project_id = p.project_id
	</select>
	
	<select id="getProjectList" resultMap="project">
		SELECT * FROM scstudio.project
	</select>
	
	<select id="getProjectListByPersonUid" resultMap="project">
		SELECT p.project_id, p.project_name, p.start_date, p.end_date, p.project_status_id
			FROM scstudio.project AS p,scstudio.project_person AS pt
			WHERE pt.person_uid = #value#
			AND pt.project_id = p.project_id
			ORDER BY pt.project_id
	</select>
	
	<select id="getProjectListByStatus" resultMap="project">
		SELECT *
			FROM scstudio.project
			WHERE status = #value#
			ORDER BY project_id
	</select>
	
	<select id="getProjectListByPersonUidAndStatus" resultMap="project">
		SELECT p.project_id, p.name, p.description, p.start_date, p.end_date, p.status
			FROM scstudio.project AS p, scstudio.project_person AS pt
			WHERE pt.person_uid = #param1# AND pt.project_id = p.project_id
			AND p.status = #param2# ORDER BY pt.project_id
	</select>
		
</sqlMap>
